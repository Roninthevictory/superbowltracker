<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl LX Live Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: radial-gradient(circle at center, #0a0a16 0%, #05050a 100%);
            min-height: 100vh;
            color: white;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
        }
        .win-bar { transition: width 1s ease-in-out; }
        @keyframes pulse-live {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        .live-dot { animation: pulse-live 1.5s infinite; }
        .possession-indicator { filter: drop-shadow(0 0 8px #fff); transition: all 0.3s ease; }
        .espn-red { color: #ff002b; }
        .espn-bg { background-color: #ff002b; }
    </style>
</head>
<body class="flex items-center justify-center p-4 py-12">

    <div class="max-w-3xl w-full space-y-6">
        <!-- Header & Odds -->
        <div class="flex flex-col md:flex-row justify-between items-end gap-4 px-2">
            <div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="espn-red font-black italic text-xl tracking-tighter">ESPN</span>
                    <span class="text-[9px] bg-white/10 px-2 py-0.5 rounded text-gray-400 font-bold uppercase tracking-widest border border-white/5">Unofficial Fan Tracker</span>
                </div>
                <h1 class="text-4xl font-black italic tracking-tighter uppercase">
                    Super <span class="text-blue-500">Bowl</span> <span class="text-red-600">LX</span>
                </h1>
                <div id="odds-display" class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-1">
                    LOADING VEGAS LINES...
                </div>
            </div>
            <div id="countdown-mini" class="text-right">
                <div id="timer-text" class="text-xl font-mono font-bold text-yellow-500">00:00:00:00</div>
                <div class="text-[10px] text-gray-500 uppercase font-bold">Until Kickoff</div>
            </div>
        </div>

        <!-- Main Scoreboard -->
        <div class="glass-card overflow-hidden shadow-2xl border-white/10">
            <!-- Game Header -->
            <div class="bg-white/5 p-3 flex justify-between items-center border-b border-white/10 px-6">
                <div class="flex items-center gap-3">
                    <div id="live-indicator" class="hidden flex items-center gap-2">
                        <div class="w-2 h-2 espn-bg rounded-full live-dot"></div>
                        <span class="text-[10px] font-black espn-red uppercase tracking-widest">Live</span>
                    </div>
                    <span id="game-status" class="text-xs font-bold uppercase tracking-widest text-gray-400 italic">Connecting to Feed...</span>
                </div>
                <div id="broadcast-info" class="text-[10px] text-gray-500 font-bold uppercase"></div>
            </div>

            <div class="p-6 md:p-10">
                <div class="flex items-center justify-between gap-2">
                    <!-- Home Team -->
                    <div class="text-center flex-1 space-y-3">
                        <div class="relative inline-block">
                            <img id="home-logo" src="https://a.espncdn.com/i/teamlogos/nfl/500/placeholder.png" class="w-20 h-20 md:w-24 md:h-24 mx-auto object-contain" alt="Home">
                            <div id="home-possession" class="hidden absolute -right-2 top-0 text-xl possession-indicator">üèà</div>
                        </div>
                        <div>
                            <h3 id="home-name" class="font-black text-2xl md:text-3xl uppercase tracking-tighter">Home</h3>
                            <p id="home-record" class="text-[10px] text-gray-500 font-bold"></p>
                        </div>
                        <div id="home-score" class="text-7xl font-black tabular-nums">0</div>
                    </div>

                    <!-- Center Info -->
                    <div class="flex flex-col items-center gap-4 px-4">
                        <div class="text-xl font-black italic text-white/10 uppercase">VS</div>
                        <div id="down-distance" class="bg-yellow-500/10 text-yellow-500 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-tighter border border-yellow-500/20 whitespace-nowrap hidden">
                            1st & 10
                        </div>
                    </div>

                    <!-- Away Team -->
                    <div class="text-center flex-1 space-y-3">
                        <div class="relative inline-block">
                            <img id="away-logo" src="https://a.espncdn.com/i/teamlogos/nfl/500/placeholder.png" class="w-20 h-20 md:w-24 md:h-24 mx-auto object-contain" alt="Away">
                            <div id="away-possession" class="hidden absolute -left-2 top-0 text-xl possession-indicator">üèà</div>
                        </div>
                        <div>
                            <h3 id="away-name" class="font-black text-2xl md:text-3xl uppercase tracking-tighter">Away</h3>
                            <p id="away-record" class="text-[10px] text-gray-500 font-bold"></p>
                        </div>
                        <div id="away-score" class="text-7xl font-black tabular-nums">0</div>
                    </div>
                </div>
            </div>

            <!-- Win Probability Bar -->
            <div class="px-6 pb-6">
                <div class="flex justify-between text-[10px] font-black uppercase mb-2 tracking-widest text-gray-500">
                    <span>Live Win Prob</span>
                    <span id="win-pct-label">50% / 50%</span>
                </div>
                <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden flex">
                    <div id="home-win-bar" class="win-bar h-full bg-blue-600" style="width: 50%"></div>
                    <div id="away-win-bar" class="win-bar h-full bg-red-600" style="width: 50%"></div>
                </div>
            </div>
        </div>

        <!-- System Controls & Log -->
        <div class="glass-card p-6 space-y-4">
            <div class="flex items-center justify-between gap-4">
                <div class="flex flex-col">
                    <div id="broadcast-status" class="text-[10px] font-bold uppercase tracking-widest text-blue-500">
                        Broadcasting Enabled
                    </div>
                    <div class="text-[9px] font-medium uppercase text-gray-600 tracking-tighter">
                        Embed Relay Protocol v5.1 Active
                    </div>
                </div>
                <button onclick="testBroadcast()" class="bg-white text-black hover:bg-gray-200 px-6 py-2 rounded-xl text-xs font-black uppercase transition-all whitespace-nowrap shadow-lg shadow-white/5">
                    Test Rich Embed
                </button>
            </div>
            
            <div id="log-box" class="bg-black/60 rounded-xl p-4 h-32 overflow-y-auto font-mono text-[10px] text-blue-400 border border-white/5">
                <div>[SYSTEM] Rich Embed Engine Initialized...</div>
                <div>[SYSTEM] Possession logic synchronized.</div>
            </div>

            <div class="border-t border-white/5 pt-4 mt-2">
                <p class="text-[9px] text-gray-600 leading-tight uppercase font-medium">
                    <span class="text-gray-500 font-bold tracking-widest">LEGAL NOTICE:</span> Independent fan project. <span class="text-red-500 font-bold underline">NOT affiliated</span> with ESPN or the NFL.
                </p>
            </div>
        </div>
    </div>

    <script>
        const KICKOFF_DATE = new Date("Feb 8, 2026 18:30:00 EST").getTime();
        
        const HARDCODED_WEBHOOKS = [
            "https://discord.com/api/webhooks/1469995570402820218/fO2ViwgyLsk16JIEJGI6vpofJfzybVcNB-Sc9-vclS6Dos2GtgUlPcu7MpDY9ywQjN4F",
            "https://discord.com/api/webhooks/1470207090927730931/zT49V4nIEmP-1oHC1kGEAjP6pJKUhHH15Nu0m5HiQx9Lx2jZweBVP-qZQUmIIHGUqAAf"
        ];
        
        let lastEventHash = "";
        let isInitialLoad = true;
        let lastFullData = null;

        function addLog(msg, type = 'SYSTEM') {
            const logBox = document.getElementById('log-box');
            const entry = document.createElement('div');
            entry.className = "border-l border-blue-500/30 pl-2 mb-1";
            entry.innerHTML = `<span class="text-gray-500">[${new Date().toLocaleTimeString()}]</span> [${type}] ${msg}`;
            logBox.prepend(entry);
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const diff = KICKOFF_DATE - now;
            const timerEl = document.getElementById('timer-text');

            if (diff <= 0) {
                timerEl.textContent = "GAME TIME";
                timerEl.classList.add('text-red-500');
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);

            timerEl.textContent = `${days}:${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function createWinProbBar(homeProb) {
            const length = 20;
            const homeChars = Math.round(homeProb * length);
            const awayChars = length - homeChars;
            return "`[" + "‚ñ†".repeat(homeChars) + "‚ñ°".repeat(awayChars) + "]`";
        }

        async function broadcastRichEmbed(data) {
            const { home, away, status, situation, odds, broadcast } = data;
            const homeProb = situation?.lastPlay?.probability?.homeWinPercentage || 0.5;
            const homePct = Math.round(homeProb * 100);
            const awayPct = 100 - homePct;

            // Determine which logo to show in the thumbnail (Whoever has possession)
            let thumbnailLogo = "https://a.espncdn.com/i/teamlogos/nfl/500/nfl.png";
            if (situation && situation.possession) {
                if (home.team.id === situation.possession) thumbnailLogo = home.team.logo;
                else if (away.team.id === situation.possession) thumbnailLogo = away.team.logo;
            } else if (status.type.state !== "in") {
                // Pre-game show Home logo as default or NFL logo
                thumbnailLogo = "https://a.espncdn.com/i/teamlogos/nfl/500/nfl.png";
            }

            // Embed color (Home team color if leading/favored, else Away)
            const embedColor = homePct > awayPct ? 0x2563EB : 0xDC2626;

            const embed = {
                title: `üèà ${home.team.abbreviation} ${home.score} - ${away.score} ${away.team.abbreviation}`,
                description: `**Status:** ${status.type.detail}`,
                color: embedColor,
                thumbnail: { url: thumbnailLogo },
                fields: [
                    {
                        name: `üè† ${home.team.displayName}`,
                        value: `Score: **${home.score}**\nProb: **${homePct}%**`,
                        inline: true
                    },
                    {
                        name: `‚úàÔ∏è ${away.team.displayName}`,
                        value: `Score: **${away.score}**\nProb: **${awayPct}%**`,
                        inline: true
                    }
                ],
                footer: { text: `Broadcast: ${broadcast} ‚Ä¢ Super Bowl LX Tracker` },
                timestamp: new Date().toISOString()
            };

            // Situational details
            if (situation) {
                let posText = "None";
                if (situation.possession === home.team.id) posText = home.team.displayName;
                else if (situation.possession === away.team.id) posText = away.team.displayName;

                embed.fields.push({
                    name: "üìç Game Situation",
                    value: `Possession: **${posText}**\nPlay: **${situation.downDistanceText || "N/A"}**`,
                    inline: false
                });
            }

            // Win Prob Bar
            embed.fields.push({
                name: `üìä Win Probability`,
                value: `${createWinProbBar(homeProb)}\n${home.team.abbreviation} ${homePct}% ‚Äî ${awayPct}% ${away.team.abbreviation}`,
                inline: false
            });

            const payload = {
                username: "Super Bowl LX Live",
                avatar_url: "https://a.espncdn.com/i/teamlogos/nfl/500/nfl.png",
                embeds: [embed]
            };

            addLog(`Broadcasting Possession: ${situation?.possession ? 'Active' : 'Neutral'}`, "NET");
            
            const promises = HARDCODED_WEBHOOKS.map((url, index) => 
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).then(() => addLog(`Webhook #${index + 1} Sent`, "NET"))
                  .catch(e => addLog(`Webhook #${index + 1} Failed`, "ERROR"))
            );

            await Promise.all(promises);
        }

        async function fetchProData() {
            try {
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
                const data = await response.json();
                
                // Try to find the Super Bowl (Post-season type 3) or just use the main event
                const sbGame = data.events.find(e => e.season.type === 3) || data.events[0];

                if (sbGame) {
                    const comp = sbGame.competitions[0];
                    const status = sbGame.status;
                    const home = comp.competitors.find(c => c.homeAway === 'home');
                    const away = comp.competitors.find(c => c.homeAway === 'away');
                    const situation = comp.situation;
                    const odds = comp.odds?.[0];
                    const broadcast = comp.geoBroadcasts?.[0]?.media?.shortName || "FOX/ESPN";

                    const currentData = { home, away, status, situation, odds, broadcast };
                    lastFullData = currentData;

                    // Update UI Scores & Names
                    document.getElementById('home-name').textContent = home.team.abbreviation;
                    document.getElementById('home-logo').src = home.team.logo;
                    document.getElementById('home-score').textContent = home.score;
                    document.getElementById('home-record').textContent = home.records?.[0]?.summary || "";

                    document.getElementById('away-name').textContent = away.team.abbreviation;
                    document.getElementById('away-logo').src = away.team.logo;
                    document.getElementById('away-score').textContent = away.score;
                    document.getElementById('away-record').textContent = away.records?.[0]?.summary || "";

                    document.getElementById('game-status').textContent = status.type.detail;
                    document.getElementById('broadcast-info').textContent = broadcast;

                    // Possession Indicators
                    if (situation && situation.possession) {
                        // ESPN API 'possession' field matches the team ID
                        document.getElementById('home-possession').classList.toggle('hidden', home.team.id !== situation.possession);
                        document.getElementById('away-possession').classList.toggle('hidden', away.team.id !== situation.possession);
                    } else {
                        document.getElementById('home-possession').classList.add('hidden');
                        document.getElementById('away-possession').classList.add('hidden');
                    }

                    if (situation) {
                        document.getElementById('down-distance').textContent = situation.downDistanceText || "";
                        document.getElementById('down-distance').classList.toggle('hidden', !situation.downDistanceText);
                    }

                    // Vegas Odds
                    if (odds) {
                        document.getElementById('odds-display').textContent = `LINE: ${odds.details || 'N/A'} ‚Ä¢ O/U: ${odds.overUnder || 'N/A'}`;
                    }

                    // Win Prob UI
                    const homeProb = situation?.lastPlay?.probability?.homeWinPercentage || 0.5;
                    document.getElementById('home-win-bar').style.width = `${homeProb * 100}%`;
                    document.getElementById('away-win-bar').style.width = `${(1 - homeProb) * 100}%`;
                    document.getElementById('win-pct-label').textContent = `${Math.round(homeProb * 100)}% / ${Math.round((1 - homeProb) * 100)}%`;

                    document.getElementById('live-indicator').classList.toggle('hidden', status.type.state !== "in");

                    // Smart Broadcast: Only send when relevant data changes
                    const eventHash = `${home.score}-${away.score}-${status.type.state}-${situation?.downDistanceText}-${situation?.possession}`;
                    if (eventHash !== lastEventHash) {
                        if (!isInitialLoad) {
                            broadcastRichEmbed(currentData);
                        }
                        lastEventHash = eventHash;
                        isInitialLoad = false;
                    }
                }
            } catch (error) {
                addLog("API Sync Error - Check Connection", "ERROR");
            }
        }

        function testBroadcast() {
            if (lastFullData) {
                broadcastRichEmbed(lastFullData);
            } else {
                addLog("Syncing with ESPN feed first...", "SYSTEM");
            }
        }

        setInterval(updateCountdown, 1000);
        setInterval(fetchProData, 20000); // 20 second refresh
        
        updateCountdown();
        fetchProData();
    </script>
</body>
</html>
